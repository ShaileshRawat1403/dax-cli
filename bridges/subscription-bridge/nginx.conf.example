server {
  listen 8789;
  server_name localhost;

  location /health {
    return 200 '{"status":"ok","bridge":"nginx-subscription-proxy"}';
    add_header Content-Type application/json;
  }

  location /chat/completions {
    # Caller auth token from your app
    if ($http_authorization != "Bearer change_me_bridge_token") {
      return 401;
    }

    proxy_pass https://api.openai.com/v1/chat/completions;
    proxy_set_header Content-Type application/json;

    # Inject upstream auth
    proxy_set_header Authorization "Bearer REPLACE_WITH_UPSTREAM_TOKEN";

    # Pass request body
    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }
}
